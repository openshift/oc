apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: pod-adm-mirror
objects:
- kind: Pod
  apiVersion: v1
  metadata:
    name: "${NAME}"
    namespace: "${NAMESPACE}"
    labels:
      name: admmirror
  spec:
    restartPolicy: OnFailure
    securityContext:
      runAsNonRoot: true
      seccompProfile:
        type: RuntimeDefault
    containers:
    - args:
      - |-
        timeout 3m /bin/bash -exuo pipefail -c 'while [ ! -f /etc/foo/.dockerconfigjson ]; do sleep 1; done'
        exec oc adm release mirror --insecure ${IMAGEPULLSECRET} ${IMAGESOURCE} ${IMAGETO} ${IMAGETORELEASE}
      command:
      - /bin/bash
      - -euxo
      - pipefail
      - -c
      name: cli
      image: "${CLIIMAGEID}"
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
          - ALL
      volumeMounts:
        - name: foo
          mountPath: "/etc/foo"
          readOnly: true
    volumes:
    - name: foo
      secret:
        secretName: my-secret  
parameters:
- name: NAME
- name: NAMESPACE
- name: CLIIMAGEID
- name: IMAGEPULLSECRET
- name: IMAGESOURCE
- name: IMAGETO
- name: IMAGETORELEASE
